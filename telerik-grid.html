<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link href="https://kendo.cdn.telerik.com/themes/7.0.2/default/default-main.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <script src="https://kendo.cdn.telerik.com/2023.3.1114/js/kendo.all.min.js"></script>
    <script src="/data.js"></script>
    <script src="/data-kota.js"></script>
    <script src="/json-data.js"></script>
    <script src="/editor.js"></script>

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <style>
        .k-tabstrip-items-wrapper .k-item{
            color: black;
        }
        .k-tabstrip-top > .k-tabstrip-items-wrapper{
            border-bottom-width: 0px;
        }
        .k-tabstrip-items-wrapper .k-item:active, .k-tabstrip-items-wrapper .k-item.k-active, .k-tabstrip-items-wrapper .k-item.k-selected{
            border-color: transparent !important;
        }
        .k-active .btns{
            background-color: #1485EF;
            color: white;
        }
        .bg-gry{
            background-color: #E1E2EA;
        }
        .k-grid .k-grid-header tr:first-child {
            border-bottom: none;
            background-color: #1C1C31;
            color: white;
        }
        tbody .k-grid-table th {
            background-color: #F5F6F6;
            color: black;
        }
        .k-grid .k-table{
            border-width: 1px;
        }
        .k-table-alt-row{
            background-color: transparent !important;
        }
        tbody td {
            border-bottom:1px solid rgba(0, 0, 0, 0.08) !important;
        }
        .k-detail-row{
            background-color: #E1E2EA;
        }
        #tabstrip{
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 2%;
            padding: 10px;
        }
        .k-tabstrip-top > .k-content, .k-tabstrip-top > .k-tabstrip-content{
            border-width: 0px;
        }
        .k-disabled-check{
            pointer-events: none;
            background-color: rgb(205, 205, 205);
        }
        /* border-color: rgba(0, 0, 0, 0.08); */
    </style>
    
    
</head>
<body>
    <div class="row mt-5 container-fluid">
        <h1>Lorem Ipsum</h1>
        <div class="row my-5 container-fluid">
            <div class="col">
                <input id="kd-place-chooser" />
            </div>
            <div class="col">
                <input id="kd-place-chooser2" />
            </div>
            <div class="col">
                <input id="kd-place-chooser3" />
            </div>
            <div class="col">
                <input id="kd-place-chooser4" />
            </div>
            <div class="col">
                <input id="kd-place-chooser5" />
            </div>
            <div class="col">
                <input id="kd-place-chooser6" />
            </div>
            <div class="col">
                <input id="kd-place-chooser7" />
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-3 mt-2">
                <div class="k-form-field-wrap" style="overflow-y: auto; height: 300px;">
                    <!-- <ul id="checkboxgroup"></ul> -->
                    <div id="grid_checkbox"></div>
                </div>
                <div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="filterTable()">Check</button>
                </div>
            </div>
            <div class="col-9">
                <div id="example container-fluid">
                    <div class="demo-section  mx-3">
                        <div id="tabstrip">
                            <ul>
                                <li class="k-active">
                                    <button class="btn btns">
                                        Production Activity
                                    </button>
                                </li>
                                <li>
                                    <button class="btn btns">
                                        Production Support
                                    </button>
                                </li>
                                <li>
                                    <button class="btn btns">
                                        Production Issues
                                    </button>
                                </li>
                            </ul>
                            <div>
                                <div class="mb-3 p-2 bg-gry">
                                    <button class="btn btn-light mx-1"><i class="fa-solid fa-plus"></i> &nbsp;Loading</button>
                                    <button class="btn btn-light mx-1"><i class="fa-solid fa-plus"></i> &nbsp;Hauling</button>
                                </div>
                                <button id="expand" class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>Expand All</span></button>
                                <button id="collapse" class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>Collapse All</span></button>
                                <div id="grid"></div>
                            </div>
                            <div>
                                <span class="sunny">&nbsp;</span>
                                <div class="weather">
                                    <h2>29<span>&ordm;C</span></h2>
                                    <p>Sunny weather in New York.</p>
                                </div>
                            </div>
                            <div>
                                <span class="sunny">&nbsp;</span>
                                <div class="weather">
                                    <h2>21<span>&ordm;C</span></h2>
                                    <p>Sunny weather in London.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var newItem;
        var LoadingSelected = []
        $('#expand').click(function(e){
          var grid = $("#grid").data("kendoGrid");
          $( ".k-master-row" ).each(function( index ) {
            grid.expandRow(this);
          });
        })

        $('#collapse').click(function(e){
          var grid = $("#grid").data("kendoGrid");
          $( ".k-master-row" ).each(function( index ) {
            grid.collapseRow(this);
          });
        })
        var dataTable = DATAX_FIX.map((e,i)=>{
                e.id = i+1
                return e
            });
        var dataTables = DATAX_FIX.map((e,i)=>{
                e.id = i+1
                return e
            });;
        const generateCheckbox = () =>{
            let dataCheckbox = []
            DATAX_FIX.forEach(e => {
                dataCheckbox.push({
                    label:e.loadingEqp,
                    value:e.loadingEqp,
                })
            });
            var checkBoxGroup = $("#checkboxgroup").kendoCheckBoxGroup({
                items: dataCheckbox,
                layout: "vertical",
                //value: ["1", "2"]
            }).data("kendoCheckBoxGroup");

            $("#selectAllCheckbox").change(function () {
                if (this.checked) {
                    checkBoxGroup.checkAll(true)
                } else {
                    checkBoxGroup.checkAll(false)
                }
            });
        }
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 's') {
                // Prevent the Save dialog to open
                e.preventDefault();
                // Place your code here
                $(".k-grid-save-changes").click()
                console.log('CTRL + S CLICKED');
            }
        });
        function generateTab(){
            $("#tabstrip").kendoTabStrip({
                animation:  {
                    open: {
                        effects: "fadeIn"
                    }
                }
            });
        }
        function dropdownlist_change(e) {
            var value = this.value();
            console.log(value)
            console.log("MHASOOK")
        // Use the value of the widget
        }
        function option(){
            
            var dataSource = new kendo.data.DataSource({
            data: [
                { ID: 1, NAME: "CE6164 - 6020"},
                { ID: 2, NAME: "CE6164 - 6021"},
                { ID: 3, NAME: "CE6164 - 6022"},
                { ID: 4, NAME: "CE6164 - 6023"},
            ],
            sort: { field: "NAME", dir: "asc" }
            });

            $("#kd-place-chooser").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Project ID',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser2").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Daily Plan ID',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser3").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Actual Prod. ID',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser4").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Supervisor',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser5").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Foreman',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser6").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Date',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });

            $("#kd-place-chooser7").kendoDropDownList({
                filter: "contains",
                optionLabel: 'Shift',
                dataTextField: "NAME",
                dataValueField: "ID",
                dataSource: dataSource
            });


            
            $("#tab-app").kendoTabStrip({   
                animation: { open: { effects: "fadeIn" } }
            });
        }
        function onRead2(options) {
            console.log(dataTables,"3")
            options.success(dataTables);
        }
        var crudServiceBaseUrl = "https://demos.telerik.com/kendo-ui/service"
        function OnUpdate (){
            console.log("UPDATE")
        }
        function OnUpdate2 (){
            console.log("UPDATE2")
        }
        const filterTable = () =>{
            //var checkGroup = $("#checkboxgroup").getKendoCheckBoxGroup();
            //console.log(checkGroup.value());
            console.log(dataTables,"1")
            dataTables = dataTable.filter(e=>{
                if(LoadingSelected.includes(e.loadingEqp)){
                    return e;
                }
            })
            console.log(dataTables,"2")
            generateTable()
        }
        const generateTable = (data) =>{
            $("#grid").empty()
            //return 0;
            var element = $("#grid").kendoGrid({
                //editable: "incell",
                // dataSource: {
                //     // pageSize: 6,
                //     // serverPaging: true,
                //     // serverSorting: true
                // },
                editable: "incell",
                navigatable: true,
                dataSource : new kendo.data.DataSource({
                    dataType: "jsonp",
                    transport: {
                        //read: "https://demos.telerik.com/kendo-ui/service/Northwind.svc/Employees"
                        read:onRead2,
                        update: OnUpdate2,
                        parameterMap: function(options, operation) {
                            console.log("Mashook")
                            if (operation !== "read" && options.models) {
                                console.log(options)
                                console.log(operation)
                                //return {models: kendo.stringify(options.models)};
                            }
                        }
                    },

                }),
                height: 600,
                scrollable: false,

                // sortable: true,
                // pageable: true,
                detailInit: detailInit,
                dataBound: function() {
                    this.expandRow(this.tbody.find("tr.k-master-row").first());
                },
                columns: [
                    {
                        title: "Loading Equipment",
                        field: "loadingEqp",
                        width: "120px"
                    },
                    {
                        title: "Service",
                        field: "service",
                        width: "120px"
                    },
                    {
                        title: "Operator",
                        field: "operator",
                        width: "120px",
                    },
                    {
                        title: "Foreman",
                        field: "foreman",
                        width: "120px",
                    },
                    {
                        title: "Supervisor",
                        field: "supervisor",
                        width: "120px",
                    },
                    {
                        title: "Location",
                        field: "location",
                        width: "120px",
                    },
                    {
                        title: "Material",
                        field: "material",
                        width: "120px",
                    },
                    {
                        title: "Production",
                        field: "production",
                        width: "120px",
                    },
                    {
                        title: "UOM",
                        field: "uom",
                        width: "110px",
                    },
                    { command: [{
                            name: "Copy",
                            click: function(e) {
                                
                                // prevent page scroll position change
                                e.preventDefault();
                                // e.target is the DOM element representing the button
                                var tr = $(e.target).closest("tr"); // get the current table row (tr)
                                // get the data bound to the current table row
                                newItem = this.dataItem(tr);
                                console.log(newItem)
                                let copy = [] ;
                                let newDataTable = JSON.parse(JSON.stringify(dataTable)); 
                                newDataTable.forEach(e=>{
                                    if(e.id == newItem.id){
                                        copy.push(e)
                                    }
                                })
                                console.log(copy)
                                copy[0]['id'] = newDataTable.length+1
                                //console.log(datay)
                                console.log(newDataTable)
                                dataTable.push(copy[0])
                                dataTables.push(copy[0])
                                generateTable()
                                //this.addRow()
                            }
                        }]
                    },
                ]
            });
        }
        $(document).ready(function() {
            generateTab()
            generateCheckbox()
            option()
            generateCheckData()
            
        });
        let idData = ""
        function onRead(options) {
            // console.log(dataTable)
            let filter_data = dataTable.filter(a=>{if(a.id == idData){
                return a.data
            }})
            if(filter_data.length){
                options.success(filter_data[0].data);
            }
        }
        //"https://demos.telerik.com/kendo-ui/service/Northwind.svc/Orders"

        var datac =  [
            { OperatorID: "1", OperatorName: "Syaifullah - 11"},
            { OperatorID: "2", OperatorName: "Wijaya Agung - 11"},
        ]

        var bagian =  [
            { OperatorID: "1", OperatorName: "Syaifullah - 11"},
            { OperatorID: "2", OperatorName: "Wijaya Agung - 11"},
        ]
        const ChangeFunction = () =>{
            console.log("Test")
        }
        
        const onDataBound = () =>{
            console.log("DATA BOUND")
        }
        function detailInit(e) {
            idData = e.data.id
            $("<div  style='width:1000px' />").appendTo(e.detailCell).kendoGrid({
                editable: "incell",
                navigatable: true,
                //groupable: true,
                reorderable: true, // ----- Freez Column Custom
                toolbar: ["create","save"],
                edit:function(){
                    console.log("MASUK EDIT")
                    //optionTable()
                },
                save: function (e) {
                    if (e.values.hasOwnProperty("start_hour") ||
                            e.values.hasOwnProperty("end_hour")) {
                        var totalSpan = e.container.closest("TR").find(".totalSpan");
                        if (e.values.hasOwnProperty("start_hour")) {
                            totalSpan.html(e.values.start_hour * e.model.end_hour);
                        }
                        else {
                            totalSpan.html(e.values.end_hour * e.model.start_hour);
                        }
                    }
                },
                dataBound: onDataBound,    
                dataSource : new kendo.data.DataSource({
                    batch: true,
                    dataType: "jsonp",
                    transport: {
                        //read: "https://demos.telerik.com/kendo-ui/service/Northwind.svc/Employees"
                        read:onRead,
                        update: function(e){    
                            console.log("update");
                            console.log(e);
                            e.success();
                        },
                        destroy: function(e){    
                            console.log("destroy");
                            console.log(e);
                            e.success();
                        },
                        create: function(e){    
                            console.log("create");
                            console.log(e);
                            e.success();
                        },
                        parameterMap: function(options, operation) {
                            console.log(options)
                            console.log(operation)
                            if (operation !== "read" && options.models) {
                                //return {models: kendo.stringify(options.models)};
                            }
                        },                                    
                        change: function (e) {
                            console.log("ITEM CHANGE")
                            console.log()
                            if (e.action == "itemchange") {
                                console.log("ITEM CHANGE2")
                                //debugger;
                                // apModel.getProductQuantities(e.items[0].ProductCode).ifFetched().then(function (data) {
                                //     var data = JSON.parse(data.Response);
                                // })
                                // //how to access next cell???

                                // $("#ap-grid").data("kendoGrid").saveRow();

                            }
                        },
                    },
                    schema: {
                        model: {
                            id: "haulingEq",
                            fields: {
                                haulingEq: { type: "string" },
                                Operator: { 
                                    defaultValue: {
                                        OperatorID: "",
                                        OperatorName: ""
                                    }
                                },
                                Provinsi: { 
                                    defaultValue: {
                                        ProvID: "",
                                        ProvName: ""
                                    }
                                },
                                Kota: { 
                                    defaultValue: {
                                        KotaID: "",
                                        KotaName: ""
                                    }
                                },
                                start_hour: { type: "numeric" },
                                end_hour: { type: "numeric" },
                                rit: { type: "string" },
                                cap: { type: "string" },
                                measurement: { type: "string" },
                                mesured: { type: "string" },
                                dest: { type: "string" },
                                distance: { type: "string" },
                                actMeas: { type: "string" },
                                grade: { type: "string" },
                            }
                        }
                    }

                }),
                // dataSource: {
                    

                //     // serverPaging: true,
                //     // serverSorting: true,
                //     // serverFiltering: true,
                //     // pageSize: 10,
                //     //filter: { field: "loadingEqp", operator: "eq", value: e.data.loadingEqp }
                // },
                // sortable: true,
                // pageable: true,
                
                columns: [
                    {   title: "Hauling Eq",
                        field: "haulingEq", 
                        width: "110px",
                        locked: true,
                        lockable: false,
                    },
                    { 
                        title: "Operator",
                        field: "Operator.OperatorName", 
                        width: 180,
                        editor: clientCategoryEditor ,
                    },
                    { 
                        title: "Provinsi",
                        field: "Provinsi.ProvName", 
                        width: 180,
                        editor: ProvinsiEditor ,
                    },
                    { 
                        title: "Kota",
                        field: "Kota.KotaName", 
                        width: 180,
                        editor: KotaEditor ,
                    },
                    { 
                        title: "Harga",
                        field: "start_hour", 
                        width: "110px",
                    },
                    { title: "Qty",field: "end_hour", width: "110px" },
                    { title: "Total",template: "<span class='totalSpan'>#= ((data.start_hour?start_hour:0) * (data.end_hour?end_hour:0)) #</span>", editable: false , width: "110px" },
                    { title: "Rit",field: "rit", width: "110px" },
                    { title: "Cap",field: "cap", width: "110px" },
                    { title: "Measurement",field: "measurement", width: "110px" },
                    { title: "Measured",field: "measured", width: "110px" },
                    { title: "Dest",field: "dest", width: "110px" },
                    { title: "Distance",field: "distance", width: "110px" },
                    { title: "Act. Meas.",field: "actMeas.", width: "110px" },
                    { title: "Grade",field: "grade", width: "110px" },
                    { command: "destroy", title: "&nbsp;", width: 150 },
                ],
                editable: true
            });
        }

        const changeOption = (obj) =>{
            $(obj)
        }
        function onReadCB(options) {
            let dataCheckbox = []
            //let disabledData = ['CE6164 - 6022','CE6164 - 6023']
            let disabledData = []
            DATAX_FIX.forEach(e => {
                let editBy = ""
                if(disabledData.includes(e.loadingEqp)){
                    console.log("SINI")
                    editBy = "Another User"
                }
                dataCheckbox.push({
                    label:e.loadingEqp,
                    value:e.loadingEqp,
                    EditedBy:editBy,
                })
            });
            options.success(dataCheckbox);
        }
        const generateCheckData = () => {
            $("#grid_checkbox").kendoGrid({
                dataSource: {
                    pageSize: 10,
                    transport: {
                        read: onReadCB,
                    },
                    schema: {
                        model: {
                            id: "value"
                        }
                    }
                },
                //persistSelection: true,
                change: thisChange,
                columns: [
                    { 
                        selectable: true, 
                        width: "50px",
                        headerTemplate:'<b></b>',
                        // attributes: {
                        //             "class": "k-disabled-check"
                        //             },
                    },
                    { field:"label", title: "Loading" },
                    { field: "EditedBy", title:"Editor"},
                ]
            });
        }
        function thisChange(arg) {
            LoadingSelected = this.selectedKeyNames()
        }
    </script>




</body>
</html>